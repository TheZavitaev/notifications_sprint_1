# API для приёма событий по созданию уведомлений 

Принимает ивенты от планировщика и сервисов, генерирующих события, кладет их в RabbitMQ.

API представляет из себя одну ручку, на которую будут приходить запросы вида:

Приветственное письмо:
```
{
    "event_type": "welcome_letter",
    "transport": "email",
    "payload": {
            "user_id": "ad0ec496-8c65-42c5-8fa7-3cf17bdaca7f",
        }
}
```

Запланированная рассылка "рекомендуем в новогоднюю ночь":
```
{
    "event_type": "selection_movies",
    "transport": "email",
    "payload": {
            "user_categories": [
                    "new_users",
                ],
            "films": [
                    "380164b8-7503-4c15-b83d-88de95743880",
                    "380164b8-7503-4c15-b83d-88de95743880",
                    "380164b8-7503-4c15-b83d-88de95743880",
                ]
        }
}
```

Персональная рассылка:
```
{
    "event_type": "personal_newsletter",
    "transport": "email",
    "payload": {
            "user_id": "ad0ec496-8c65-42c5-8fa7-3cf17bdaca7f",
            "films": [
                    "380164b8-7503-4c15-b83d-88de95743880",
                    "380164b8-7503-4c15-b83d-88de95743880",
                    "380164b8-7503-4c15-b83d-88de95743880",
                ]
        }
}
```

Далее эти запросы перекладываются в RabbitMQ, откуда вычитываются воркером.

С ростом нагрузки, мы создадим дополнительные инстансы очереди (High, Default, Low) в которые будем перекладывать 
события в зависимости от их важности. Например, ивенты от Auth будут улетать в High очередь, персонифицированные 
в Default, а массовые рассылки в Low.